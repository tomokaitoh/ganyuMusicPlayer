#include<stdio.h>
#include<stdlib.h>
#include <windows.h>
#include<vfw.h>
#include<time.h>
#pragma comment(lib,"vfw32.lib")

#define IMG_WIDTH 50
#define IMG_HEIGHT 25
#define TMP_FILE_NAME "ganyu.mid"
#define MUSIC_DURATION 95

#define setColor(handle,color) SetConsoleTextAttribute(handle,color)
#define setCursorPos(handle,x,y) SetConsoleCursorPosition(handle,(COORD){x,y})

HANDLE hConsole;

char *music =
                                                                              "4D546864000000060001000200604D54726B00000F3"            ""                                                                                                                                               
                                                                             "C00FF58040402180800FF51030BE3D400FF03054B616E6"  ""   "" "16E00904A3E60804A"                                                                                                                              
                                                                            "0000904D485A904A3F06804D000"              "0904F47810"     "48"              "04A0"                                                                                                                        
                                                                           "00C804F000090514A3080510"      "0"        "0"       "090"    "4"  "F"     "4A8140804F00"           "00904C3E009048335480"                                                                                   
                                                                          "48000C804C000090514F3"                         "08051"  "000"  "0904F5330"          "804F00"    "00904D5760804D0000904C466080"                                                                               
                                                                         "4C00009045408110804"                         "50000904"     "C4"  "A3"                   "0804C0000904C538140804C006090404D3080400"                                                                           
                                                                         "0009041572480410"                         "00090"      ""     "4A"                          "5C06804A0000904D5C06804D000090565C00904A"                                                                        
                                                                         "5C60804A00008"                          "056"     "00009"           "0595C009"                 "04D5C54804D000080590000904F5C06804F00009"                                                                     
                                                                         "0515C068051"                           "00"   "0090"             "4F5C00905B5C811"                "0805B0000804F0000905D5C0090515C24805100"                                                                   
                                                                        "00805D0000"                           "9"   "04F"               "5C068"        "04F00"               "0090515C0680510000904F5D00905B5D811080"                                                                  
                                                                        "5B000080"                            ""   "4"                  "F00"               "309"               "04C2E0090432E009045406080450000804C000"                                                                
                                                                        "0804300"                                ""                    "009"                   "05"               "15C3080510000904F5130804F0000904C5C81"                                                               
                                                                        "10804"   "C"                                                 "00"                        "0"               "090485C3080480000904A5C18804A00009048"                                                             
                                                                        "5C"    "18"                                                  "8"                           ""               "048000090403500904A5C3080400000903E35"                                                            
                                                                       "3"     ""                                                     ""                                               "0803E00009040353080400000903E3530803"                                                           
                                                                       ""    ""                                                      ""                                                 "E00009040353080400000903E3530803E000"                                                          
                                                                                                                                                                                          "090413524804A0000804100009041360690"                                                         
                                                                                                                                                                                       "4" "54106904A4F308041000080450000804A00"                                                        
                                                                                                                                                                                         "0" "0904C4808804C0008904A4908804A00089"                                                       
                                                                     ""                                                                                                                   "0" "4C4B08804C0008904A4B08804A0008904"                                                       
                                                                   "C"       ""                   ""                                                                                           "4B08804C0000904A4B08804A0000904C4"                                                      
                                                            ""    "D"     "0"                    "8"                                                                                            "804C0000904A4E08804A0000904C4F088"                                                     
                                                          ""     ""     "0"                      "4"                                                                                             "C0000904A5100904A5108804A0000804"                                                     
                                                        ""     "A"    "00"          ""           "0"                                                                                              "0904C5308804C0000904A5608804A000"                                                    
                                                              "0"  "904"          "C"            "5"                                                                                               "A08804C0000904A5C08804A000090355"                                                   
                                                             "C" "009"           ""              "0"        "3"                                                                          ""         "E5C0090325C0C803200008035000080"                                                   
                                                           "3E" "00"                             "0"        "C"                                                                           ""         "90395C0C8039000C90355C0090325C"                                                   
                                                          "00903E5"                              "C0"       "C8"                                                                           ""         "035000080320000803E000C90375C0"                                                  
                                                         "090345"                                 "C"        "00"                                                                           ""        "90405C0C8037000080340000804000"                                                  
                                             ""         "0C9039"                                  "5C"        "0C"                                                                          ""         "8039000C90375C0090345C0090405"                                                  
                               ""                      "C0C803"                                   "700"         "00"                                                                         ""         "803400008040000C90395C009041"                                                  
                                ""              "5"   "C0090"            ""                        "355"          "C"                 ""                                                      ""         "0C80390000804100008035000C90"                                                 
                                  "" "3"     "95C"   "0C803"            ""             "9"           "00"          "0C"                ""                                                     ""          "90395C0090415C0090355C0C803"                                                 
                                    "90000804100"   "00803"            "5"             ""             "000"          "C9"              "0"                                                    "3"         "A5C0090375C0090435C0C803A00"                                                 
                                      "00803700"   "00804"            "3"             "0"               "00C"          "90"                                                                    "3"         "95C0C8039000C90465C00904F5C"                                                
                                          "009"   "04""3"            "5"             "C0"                 "C80"          "460"            ""                                                   "0"         "00804F00008043000C90455C009"                                                
                                           ""    "04" ""             ""              "D5"                    "C0"          "09041"                            "5"                               ""          "C0C80450000804D00008041000"                                                
                                           ""   "C9"                "04"    ""      "35"                         "C00"      "90405C009"                        ""                               "0"         "4C5C0C8043000080400000804C0"                                               
                                          ""   "00"                "C9"   "0"       "41"                                      "5C""00903"                      "E"                              "5"          "C00904A5C0C80410000803E000"                                               
                                         ""   "08"               """04"   "A"      "000C"                                       "9040""5C00"                   "9"                              "03"          "C5C0090485C0C80400000803C"                                               
                                       ""    "000"              "0""80"  "48"     "000C9"                                         "0415C009"                   "0"                              "4A5"          "C00903E5C0C80410000804A00"                                              
                                           "0080"               "3E000"  "C"      "90455C0"   "C"                                    "80450"                   "0"                              "0C9"            "0415C00904A5C00903E5C0C8"                                             
                                           "041"               "000080" "4A"  "0""000803""E"  "00"                                    "0C904"                  "3"                              "5C0"              "0904C5C0090405C0C80430"                                             
                                         "" "00"               "0804C0" "00"     "08""04" ""   "0"                                   "000C90"                  "4"                       "5"    "5C0C"    ""            "8045000C90435C0090"                                            
                                        "" "4C5"               "C009040" "5C"   "0C"  "80"     "4"                                 "30000804C"                "00"                       "0"    "08040"    "0"               "00C90455C00904"                                           
                                       ""  "D5"               "C0090415C" "0C8"  "0"   "45"    "00"                               "00804D00008"               "04"                       "10"  "" "00"  ""  "C90"       "455C0C8045000C90455C0"                                         
                                      ""   "09"               "0415C00904D" "5C0""C"    "8"    "045"                             "0000804100008"              "04"                       "D0"     "00"   ""  "C90465C0090435C00904F5C0C804600008"                                       
                                           "04"             "30000804F003C9"  "03E6"     "B"   "0090"                        ""  "4A6"      "B30"            "803"                        "E"     "00"    "" "00804A0000" "904D6B0090416B3080410000"                                    
                                          "804"             "D0000904F6B""0"   "09043""6B488"  "0"  ""                      ""  "430"        "00"            "080" "4"                    "F"      "0"        "00090516B0"    "090456B0C804500008051000C"            "904"              
                                          "F6B"             "0090436B8110804F0000804300"  "00"  "9"  "0"                   ""  "516"          "B0"           "090" "4"                   "56"      "B"          "18804500" ""  "0080510000904F6B0090436B1880430000804F00"               
                                          "009" "0"         "4D6B0090416B3080410000804D000""09" "0"   "4"                 "0" "6B0"            "090"        "4C6B" "1"                   "88"      "04"          "C00008"  ""   "040001890396B0090456B488045000080390000"               
                                         "904"  "C"          "6B0090406B18804C00008040000090406" "B"                    "00" "90"               "4C6B6"    "0804C""0"                    "00"      "08"           "0400"   ""     "060903E6B00904A6B30804A0000803E00009"                
                                 ""      "04"  "D6"          "B0090416B3080410000804D0000904F6B009"                    "04" "36B""48"            "80" "" "430000""80"                    "4"       "F00"            "009"  ""      "0516B0090456B0C804500008051000C904"                 
                                ""       "F6B" "00"           "90436B811""080"  "430000804F0000905"                  "16"  "B00"      "9045"      "6B" "18804500""0"                    "08"       "05100"            "00904"        "F6B0090436B1880430000804F00009"                   
                                          "04"  "D6"          "B0090416B3080"  "410000804D0000""90"                 "40"  "6B" "00904C6B18804C0"   "000" "80400""01"                    "89"      "0406B00"             "904"         "C6B48804C00008040000090486B0"                    
                                      ""  """0" "90"           "546B18805""4"  "000080480000904""8"               "6B0"  "09""0546B8134805400008048" "00" "009" "0"                     "51"      "6B0680510"             "00090546"     "B068054000090566B00904A"                      
                                 ""  ""     "6" "B30"          "804A0000" "80" "56" "000090546" "B"             "009"  "04" "86B3080480000805400009"  "051""6B""0"                      "09"      "0456B4880450"     "00080510000"           "904A6B00903E6B18"                         
                              "" "" ""      "80""3E0"           "000804A0" "0"  "0"  "090"  "5" "" ""        "16B00"  "90"       "456B81108045000080510000904" ""                       "F6"       "B0090""436B1880430000804F"                                                          
                              ""   ""        "0000904"          "D6B00904" "16"  "B"          "18"""     "8041000"  "08"        "04D0""000904C6B0090406B" "30""8"                       "04"   ""   "00000804C000090486B00"                                                             
                              ""              "903C6B3"  "08"    "03C0000"   "8"  "0"     "4"  ""   "8000090" "456B0"           "090396B48803900008045000090""4"                        "C6"  "B0"   "090406B18804000008"""                                                             
                              ""  ""           "04C000"   "09"    "0406B0"                "0904C6B60804"   "C0000"              "80400060904A6A00903E6A3080" "3"                       "E00" "0""08"  "04A0000904D63009"                                                                
                                                 "04163"   "30"    "80410"                 "00"                                 "0" "804D0000904F5C" "60804F00"       "0"             "090515C" "24"   "80510000904F5C82"                                                               
                               ""                 "5C804F0""0009"    "051"                                                      "5C" "308051"  "00" "00"  "90"       "4"             "F""5C30" "804F"   "0000904C5C6" "08"                                                              
                               ""                 "04C0000" "90485C"   "6"                                                       "08"     "0"      "48"  "000"     "090"           "4A5""C6" "090564"    "360805600"  "00"                                                              
                                ""          ""  "" "9056436" "08056000" "09"                                                                "0"  "56"   "43"     "6080"           "4A0""000""8056000"     "090""564" "36"                                                               
                                  ""                "0805600""00905643608"                                                                "056000"     "09"   "056436"          "08056""000090564381"      "40"  "805"         ""                                                       
                                  ""                 "60018903E3900903239"                                                                 "0C"        "8"  "03E00008"        "032000" "0903E390C803"      "E00"                                                                        
                                   ""            ""       """0090393A0C80"                                                                           "39" "000C9032"       "3C00903""""E3C0C80320000"      "803E"                                                                       
                                                   ""    "00""00903E3C0C8"                                                                          "03"                "E000090403"  "D0090343D0C80"      "34000"                                                                      
                                                   "08040000C""9039400C80"                                                                         "39000C""904041009034410C80400000" "803400009040"       "410C80"                                                                     
                                                  "4000" "0090""4141009035"                                                                      "410C80410000803"    "5000C9039400C""8039000C90414"       "3009035"             ""                                                     
                                                 "430C804" "10000803500009"                                                                    "041440C80410000"     "9043460090374""60C8037000080"       "43000C90"                                                                    
                                                "39490C803"   "9000C9043490"                                                                  "0904F490090464"     "90C80430000804F00008046000C90"        "41"  "490"                                                                   
                                                "0904D49009045"   "490C80410"               ""                                             "000804D000080450"   "00C904C4A0090404A0090434A0C804C0"   ""  "00"   "080"                                                                   
                                               "4000008043000C904A""4B00903E4"              "B0"                                         "090414B0C804A000"   "0803E00008041000C90484B00903C4B00"   "9" "040"   "4B0"                                                                   
                                               "C80480000803C00008040000C903E4"               "C0"       "090"                "4A4""C0090414C0C803E00008"  "04A000080410""000904A4C0C804A000090"   "4""54C0"    "C80"                                                                   
                                              "45000C903E4C00904A4C0090414C0C803"               "E00" "00804"                  "A000080410000904A4E0C80""4A000090404E00""904C4E0090434E0C80430"  "00""0804"      "00"            ""                                                     
                                           "000804C000C90454E0C8045000C90404F0090"                                                            "4C4F0090434F0C8040000080""4C000080430000904C5"   "00C804"         "C0"                                                                   
                                         "00090415200904D52009045520C80450000804100"                                                          "00804D000C9045550C80450" "00C904D56009041560"  "090455"           "6"      ""                                                            
                                        "0C804D000080410"    "00080450000904D570C804"                                                       "D000090435800904F5800904" "6580C804600008043"  "0000804"             ""                                                                    
                                      "F000C90455C0C80"        "45000C90525D00905B5D00"                                                   "904F5D0C80520000805B000""" "0804F000C90515E0"  "090595E009"                                                                                  
                                     "04"   "D5E0C805"          "1000080590000804D000C90"                                     "4F6100904C61009058610C804F0000804C"  "00008058000C904D6300904A630" "09"                      ""                                                          
                                   "0"      "56630C8"             "04D0000804A00008056000"                                     "C904C6400904864009054640C804C000"  "0804800" "008054000C904D6600" "905"                                                                                 
                                  ""         "666009"               "04A660C804D0000805600"                                     "00804A00009056660C805600009051" "670C8051"   "000C904D680090566" "80"                  ""                                                              
                                             "0904A"                "680C804D000080560000804"                              "A00009056680C80560000904F68009058" "6800904C6"      "80C804C0000804F"  "0"                 ""                                                               
                                               "000"                "8058000C9051680C8051000C"                   "904F680090586800" "90"    "4C680C804F000080580000804C0"        "0009058680C80"   "5"""                                                                                
                                                "80"               "0009051690090596900904D690C804D0000805100008059000C90516B0C8051000" "C90516B00904D6B0090596B0C80510"   "000804D00008059000"   "0"                                                                                   
                                                 "9"              "0596C0C8059000090526E00904F6E00905B6E0C805B000080520000804F0""03C" "904D6B00904A6B0090566B30804D0000" "804A000080560000905"   "1"                                                                                    
                                ""                               "6B0090596B00904D6B30804D00008059000080510000905B6B00904F6B0C9056" "5F0C8056000090525F0C805200""0090515F0C8051000090525F0C8"   "0"  ""                                                                                 
                                ""                              "52000090515F0C804F0000805B000080510000905D6B""0090516B0C805""10" "000805D000090565F0C80560000""904F6B00905B6B0C90565F0C805"       "60"     ""                                                                          
                                                              "00090525F0C8052000090515F0C8051000090525F0C805200009""0515F" "0C""8051000090525F0C805200009056""5F0C8056000090515F0C8051000"       "090"                                                                                 
                                                             "565F0C8056000090525F0C8052000090515F0C805B0000804F0000805" "1000""090546B00905D6B0090516B18805100""0080540000805D000090526"       "B009"                                                                                  
                                                           "05B6B00904F6B18804F0000805B00008052000090516B00904D6B0090596B308" "0590000804D00008051000090586B0" "0904F6B00904C6B18805800"      "00804C"                                                                                  
                                                         "0000804F0018904F6B00904C6B0090586B4880580000804F0000804C00009048" "5A0C80480000904D5D0C804D0000""9051610C805100009054660C80"     "540000905"                                                                                  
                              "86B0C8058000090546B0C8""05400009051690C80510000904D640C804D000090485F0C804800009045630C804" "500009051570C80510000904D570C804D0000904A590C804A000090"     "455B0C80450"                                                                                  
                        "000"  "904D540C804D0000904A5B0C804A00009045630C80450000904D630C804D0000904D6B00904A6B0090566B30""80560000804D0000804A000090516B""0090596B00904D6B30804D00""00805900008051000"                                                                                  
                    ""  "090526B00904F6B00905B6B48805B0000804F00008052000090516B00905D6B0C805D00008051000C904F6B00905B6""B8110805B0000804F00009055"  "6B0090516B00905D6B18805D00008051000080550000905"                                                                                  
                 ""  "26B00904F6B00905B6B18805B0000804F00008052000090516B00904D6B0090596B308059000080510000804D0000904" "F6B00904C6B0090586B1880" "580000804F0000804C001890515A00904F6B00904C6B00905"                                                                                   
               "" "86B0C8051000090545A0C8054000090515A0C8051000090545A0C8054000090515A0C8051000090545A0C80" "54000"     "0804F0000804C0000805"  "8000090546B0090606B18806000008054000090595A0090606B"                                                                                   
                 "0090546B0C8059000090585A0C8058000090595A0C80590000905D5A0C805D000090595A0C8059000090585A0C805800" "0" "090595A0C80590""0"     "00905D5A0C805D000090595A0C8059000090585A0C805800009"                                                                                   
            "" "0595A0C80590000905D5A0C805D000090595A0C805900009058" "5A0C805""8000C805400008060000090516B068051000" "" "090546B068054"       "" "0000904A6B0090566B3080560000804A000090486B0090546B"                                                                                   
          "" "308054000080480000904A6B00904D6B0090456B48804A00"      "00804D000080450000903E6B18803E000090456B6" "08"   "045000090406"         ""  "B0090436B0090486B3080480000804300008040000090436"                                                                                   
            "B188043000090416B188041000090406"           "B3080"     "400000903C6B60""803C00009056491880560000905""149""""1880510" "0"       "0"     "0904F4918804F0000"  "905449188054000090514918"                                                                                    
        ""  "80510000904D4918804D00009"                         "04""C4918804C0000904F4918804F0000904C4918804C00009048491" "8804""800"     ""      "0"  "0904549"               "188045000090434918"                                                                                    
          "8""04300009045491880450"                                  "0489043460C9041430C8"   "043000090403F0C804100825C804" "000""8"   "4"     "78F""F2F"                        "004D54726B00000BF"                                                                                   
              "500FF03044B69726"                                     "900B04000"   "04B04"      "07F81"  "24903A2506904""1"    "2A0"  "6"            "9"                           "043300C803A00608"                                                                                   
        "0"    "41000""C80430"                                      "08134B04"  "0000"            "4B0407"  "F50903C2706"""       "90"             ""                               "432B12803C003C80"                                                                                  
          "4"    "300"  "8238"                                    "90402E"   "00904"             "32E00B0"  "400004" "B0"       ""  "4"          ""                                  "07F810C80400000"                                                                                  
             ""   "804"  "300"                                "817090""32" "440"               "09"  "0264" "400B0400004"   "B"   "0"  "407"   "F"                                    "813C8026000080"                                                                                  
               "3"       "200"                             "0090304F0090244F81"              "408""0240" "00080300000902"  ""       "B"  "4" "F"                                       "00B0400004B04"                                                                                  
                "0"      "7F8"                         "13C802"   "B0000903" "44F"         "81"  "40803" "4000090304""F00"       "B04"   "000"                                         "04B0407F813C8"                                                                                  
                  ""     "03000"                    "009034"   "4"       "F0090244F"     "60" "B"   ""  "0400004B0407""F5"       "C8"    "02"                                           "400008034000"                                                                                  
                  "0"   "90324F0"                 "090264F8330"     "8026"   "000""0"  "80"  "32"     "008110901A5C0090265C"  "00"       ""                                              "B0400004B04"                                                                                  
                  ""   "07F08801A"                "00008026005490265"  "C009"  "01A5C00"       "B040""0004B0407F0880260000801A"         ""                                               "0054901A5C0"                                                                                  
                     "090265C00B0"               "400004B0407F08801A00"   "0"     "0802""6"      "0054901""A5C0090265C00B0400"         "0"                                               "04B0407F0880"                                                                                 
               "1A000080260054902"                "E5C0090225C00B0400004B"   "" ""  "0407F08802E"  "0000""80220054902E5C"              ""                                                 "0090225C00B"                                                                                 
   "0400004B0407F08802E000080220"                "054902E5C0090225C00B040000"  "4B0" "407F"   "08802E00""0080220018902E"               ""                                                 "5F0090225F"                                                                                  
                       "0C80""2"                "" "20000802E0018902E660090226"  "60C8"  "02""E0000802""2000C90226D0"                 "0"                                                 "902E6D00B0"                                                                                  
                      "4000""0"                 ""   "4B0407F0880"  "220000802E0"  "05"    "4902B5C00901F5C00B0400"                   ""                                                  "004B0407F"                                                                                   
                    "0880"                     "2""B0000801F001"     "8902B5C0C802"        "B0000901F5C0C801F000C"                  "9"                                                    "02B5C0C"                                                                                    
                                               "802B000C901F5C"  "00"  "902B5C00B04"    "000""04B0407F08801F000"                    ""                                                     "08"                                                                                         
                                             "02B0018902B5C0C" "802B0"  "000901F5C0C8" "01F000C902B5C0C802B00"                   "00"                                                      "902B5C0C8"                                                                                  
                          """02B00"     "0090245C0090305C00"  "B0" "400004B0407F088030" "00008024001890305C"                    "0C8"                                                      "030000090245"                                                                               
                             "C0C8024000C90305C0C8030000C9" "0245C0090305C00B0400004B04" "07F" "0880300000"   ""              "802400"                                                      "1890305C0C803"                                                                             
                             "0000090245C0C8024000C90305C0C8030000090305C0C8030000090295" "C" "00901D5C00B04""0"        ""  "0004B040"         ""                                           "7F0880290000801D"                                                                          
                            "001890295C0C80290000901D5C0C801D000C90295C0C8029000C901D5C00"  "90295C00B04000""0"      ""   "4B0407F0880"         ""                                         "1D00008029001890295C0C"                                                                     
                          "80290000901D5C0C801D000C90295C0C8029000090295C0C8029000090325C0090265C00B0""40" "0"    "0"   "04B0407F08802"         ""                                         "600008032001890325C0C803200"                                                                
                        "0090265C0C8026000C90325C0C8032000C90265C0090325C00B0400004B0407F088026000080320" "0""1890"  "325C0C8032000090"                                                    "265C0C8026000"                                                                              
                     "C90325C0C8032000090325C0C80320000902B5C00901F5C00B0400004B0407F08801F0000802B00189""02B5C0" "C802B0000901F5C0C801"                                                   "F000C902B5C0C80"                                                                            
                   "2B000C901F5C00902B5C00B0400004B0407F08801F0000802B0018902B5C0C802B0000901F5C0C801F0""00C902" "B5C0C802B0000902B5C0C8"         "0"                                      "2B000090305C00"  ""                                                                         
                "90245C00B0400004B0407F08802400008030001890305C0C8030000090245C0C8024000C90305C0C803"   "0000"    "C90245C0090305C00B0400"         "0"        "0"                          "4B0407F0"      "880"                                                                        
              "2400008030001890305C0C8030000090245C0C8024000C90305C0C8030000C901D5C0090295C00B04000"   "04B"  "04" "07F08801D000080290018"     ""  "9"       "0295"                       "C0C802"        "900"""                                                                       
             "00901D5C0C801D000C90295C0C8029000C901D5C0090295C00B0400004B0407F08801D000080290018902"  "95"  "C0C80290000901D5C0C801D000C90"        "29"     "5"  "C0"                    "C80"           "29000090"                                                                     
             "295C0C80290000902A5C00901E5C00B0400004B0407F08801E0000802A0018902A5C0C802A0000901E5C0"  "C" "801E000C902A5C0C802A000C901E5C00"        "9"     "0"    "2A"                "5C0"            "0B0400004B"                                                                    
            "0407F08801E0000802A0018902A5C0C802A0000901E5C0C801E000C902A5C0C802A000C901F5C00902B5C0"   "0B0400004B0407F5CB0400004B0407F5C801"       "F"     "0"      "0"             "008"  "02B"      "000090285C009"                                                                  
            "01C5C00B0400004B0407F5C801C000080280000902D5C0090215C00B0400004B0407F5C80210000802D000"   "090325C0090265C00B0400004B0407F08802"       "6"     ""        "00"         "008" "032001"    "890325C0C8032000"                                                                 
           "090265C0C8026000C90325C0C8032000C90265C0090325C00B0400004B0407F08803200008026001890325C0"   "C8032000090265C0C8026000C90325C0C803"       ""     ""          "2"      "00"  "0090305C0"  "C80300000902F5C0090"                                                               
           "235C00B0400004B0407F5C80230000802F0000902E5C0090225C00B0400004B0407F5C802E000080220000902"    "B5C00B0400004B0407F813C802B00009041"      ""    "3"        "8""06"   "90" "464006904A4" "7810480410006804600068"                                                             
           "04A002490404300904543009048438140804000008045000080480000903C4F8140803C0000903E438300803E000"    "0904A4360804A008300B0400004B0407F"     "1"   "4"        "901A39" "0" "09026390C801""A00008026002490263C0C80260"                                                           
           "00C901A3D0090263D00B0400004B0407F08801A0000802600249026410C8026000C901A41009026410C80260000801A0""00CB0400004B0407F149026430C8026000"    "C"   "9""0"    "1A46009026""460C801A00008""0260024" "90264900B0400004B04"                                                         
           "07F088026000C901A49009026490C801A00008026000C90264A0C8026000C901A4B0090264B0C801A00008026000C90264B00B0400004B0407F088026000C902B4C00"   "9"   "0""1F4"  "C0C802B00""00801F0024902""B4C0C8" "02B000C901F4E00902B4E00"                                                       
           "B0400004B0407F08801F0000802B0024902B4F0C802B000C901F5200902B520C801F0000802B000CB0400004B0407F14902B560C802B000C901F5800902B580C801F000"  "0"  "8""02B0024902B5D00B0400004B0407F0""8802B"  "000C901F5E00902B5E0C801F00"                                                     
           "00802B000C902B610C802B000C901F6300902B630C801F0000802B000C902B6400B0400004B0407F08802B000C902E66009022660C802E00008022000C902E670C802E000""C" "90""226800902""E680C80220000802E0""00C9" "02E680090226800B0400004B0407F088"                                                  
           "02E00008022000C902E680C802E000C90226800902E680C80220000802E000C902E69009022690C802E00008022000C902E6B00B0400004B0407F08802E000C90226B""00902" "E6B0C80220""000802E000C902E6E009""0226" "E0C802E00008022008104B0400004B0407F1"                                               
            "4902B5F00901F5F0C801F0000802B0018902B5F0C802B0000901F5F0C801F000C902B5F0C802B000C901F5F00902B5F0C801F0000802B0018902B5F0C802B0000901""F5F0C""801F000C90"   "2B5""F00B0400004" "B04" "07F08802B0000902B5F0C802B000090305F00902"                                             
             "45F0C802400008030001890305F0C8030000090245F0C8024000C90305F00B0400004B0407F088030000C90245F0090305F0C803000008024001890305F0C8030""0000902" "45F0C8024"     "00" "0C90305"  "F00" "B0400004B0407F088030000090305F0C8030000090295"                                         
             "F00901D5F0C80290000801D001890295F0C80290000901D5F0C801D000C90295F0C8029000C901D5F0090295F0C801D00008029001890295F0C80290000901D5F0C801D000C90295F0C802"       "9"          "000" "0""90295""F0C8029000090295F00901D5F0C801D00008029"                                      
              "001890295F0C80290000901D5F0C801D000C90295F0C8029000C901D5F0090295F0C801D00008029001890295F0C80290000901D5F0C801D000C90295F00B04000" "04B0407F""088""0"        "29"       "000" "" "C90285F""00902B5A0C802B00008028000090325A0C80320000"                                  
               "90375A0C80370000903A5A0C803A000090345F0090405A0C8040000080340000903A5A0C803A000090375A0C8037000090325A0C80320000902B5A0090285F0C80" "2B0000802800""0"         "09"     "032"    "5A0C8032" "000090375A0C80370000903A5A0C803A000090405A00"                               
                "90345F0C803400008040000090375A0C8037000090345A00B0400004B0407F088034000090325A0C80320000902B5A00902D5F0C802D0000802B000090315A0C8""031000090""3" "45"         "A0"   "C803"    "400009039" "5A0C8039000090315F00903D5A0C803D000080310000903"                           
                  "95A0C8039000090345A0C8034000090315A0C80310000902D5F00902B5A0C802B0000802D000090315A0C8031000090345A0C8034000090395A0C80390000903D5A0090315" "" "A"            "0" "C803"    "100008""03D""000C902D5A00B0400004B"  "0407F08802D000C901A5F0090"                        
                   "265F0C801A00008026001890265F0C80260000901A5F0C801A000C90265F0C8026000C901A5F0090265F0C801A00008026001890265F0C80260000901A5F0C801" "A000C"   "90"             "2" "65"     "F00B0"   "4" "00004B0407F088026000"     "090265F0C80260000902F5F0090"                   
                     "235F0C80230000802F0018902F5F0C802F000090235F0C8023000C902F5F0C802F000C90235F00902F5F0C80230000802F0018902F5F0C802F000090235F0C80" "23000"  "C9"              "0""2F"     "5F00B""04"    "00004B0407F08802F000"         "C902B6B00901F5F8140801F00"                
                      "00802B0000902D6B0090215F814080210000802D0030903E598158803E00814090513F0090543F0090583F822080510024805400248058008478FF2F00";

char ganyuImg[IMG_WIDTH*IMG_HEIGHT+1] =
    "00000000000000000000000000000000000000000000000000"
    "00000000000000000000000000000000000000000000000000"
    "00000000000000000000000000000000000003D54655D30000"
    "000000000000000000000000000000000006AAEEE9FECAE500"
    "0000000000000D65530000000000000000A1EF4FFFF6491EA0"
    "000000000006A1633300000000300000041FF4FFF6D9CA1119"
    "00000000006EA3003679600DD22DD30006E94FF6DD3611111F"
    "0000000000077357AA79D0D232333300000D05BDDD3B6DFE90"
    "000000000000664977779AAA9F653330000051EFFFEC146D00"
    "00000003325474949AA99AACCAAA946666450D494565330000"
    "0000003306AC9AA947AAA9779999AA99974430D00000000000"
    "00000000D1A94AAAA7799997779999979A4466500000000000"
    "00000000FCAA47A9499477974749999A447450000000000000"
    "00000000AA997749764994679A44A999447793000000000000"
    "00000007A99949749947A74F44457997677669300000000000"
    "00000DA65A797499999997FCEEEF477A67C730000000000000"
    "000000003974A467764AA4F1EF4F488847A45D000300000000"
    "00000000359964FEEF494FF666446844444FCCAF4600000000"
    "00036EAACF4744F66FF7FCEEFEE686446FEC111111F0000000"
    "00FA111111F66535FECEEEEFEF686479C11CCCCCC11AD00000"
    "034A11111CCE940055566477F686F111CCCCCCCCCCC1AD0000"
    "0000D4A111111115000568446656E1CCCCCCCCCCCC111A3000"
    "000000003DD5554453330559C11CC11111111111111A4D0000"
    "000000000000000000000003DD56444F999FF465D300000000"
    "00000000000000000000000000000000000000000000000000"
;

//颜色表
COLORREF colors[16] = {
    RGB(0,0,0),RGB(255,255,255),RGB(166,50,67),RGB(39,38,47),
    RGB(163,166,177),RGB(95,102,122),RGB(127,135,152),RGB(180,198,224),
    RGB(137,177,233),RGB(206,220,236),RGB(229,243,252),RGB(118,147,59),
    RGB(253,254,250),RGB(68,68,65),RGB(250,239,225),RGB(209,199,188)
};

//在当前目录下创建临时的midi文件(ganyu.mid)
void createTmpMidFile(){
    //将music中的十六进制字符串转化为字节型数组(char[])
    int len = strlen(music);
    char *fileData = (char*)malloc(sizeof(char)*len/2+1);
    char t[3] = "00";
    for(int i=0;i<len;i+=2){
        t[0]=music[i];
        t[1]=music[i+1];
        fileData[i/2] = (char)strtol(t,NULL,16);
    }

    //以二进制形式写入临时文件
    FILE* fp;
    fopen_s(&fp,TMP_FILE_NAME, "wb");
    if (fp != NULL){
        fwrite(fileData, sizeof(char),len/2,fp);
        fclose(fp);
    }
}

//调用Windows提供的媒体接口，播放midi音乐文件(ganyu.mid)
DWORD playMusic(PVOID pArg){
    HWND hwnd;
    hwnd = MCIWndCreateA(GetForegroundWindow(),GetModuleHandle(0), WS_CHILD | 8,TMP_FILE_NAME);
    if (MCIWndCanPlay(hwnd))
        MCIWndPlay(hwnd);
    return 0;
}

//设置控制台窗口的编码方式、大小、标题、获取窗口句柄、字体颜色、颜色表、隐藏光标
void initWindow(){
    system("chcp 65001"); //设置编码方式为utf-8
    system("mode con cols=100 lines=32");
    system("cls");
    SetConsoleTitleW(L"甘雨-梦里韶光");
    hConsole = GetStdHandle(STD_OUTPUT_HANDLE);
    
    //设置颜色表
    CONSOLE_SCREEN_BUFFER_INFOEX csbi = {sizeof(CONSOLE_SCREEN_BUFFER_INFOEX)};
    GetConsoleScreenBufferInfoEx(hConsole, &csbi);
    memcpy(csbi.ColorTable, colors, sizeof(colors));
    SetConsoleScreenBufferInfoEx(hConsole, &csbi);

    //隐藏光标
    CONSOLE_CURSOR_INFO curInfo;
	curInfo.dwSize = 1;
	curInfo.bVisible = FALSE;
	SetConsoleCursorInfo(hConsole, &curInfo);
}

//根据ganyuImg中的数据绘制椰羊
void drawGanyu(){
    for(int i=0;i<IMG_HEIGHT;++i){
        setCursorPos(hConsole,20,i);
        for(int j=0;j<IMG_WIDTH;++j){
            //十六进制字符转为整型数据
            int colorId = ganyuImg[i*IMG_WIDTH+j];
            if(colorId <= '9') 
                colorId = colorId - '0';
            else 
                colorId = colorId - 'A' + 10;
            setColor(hConsole,colorId);
            printf("#");
        }
    }
}

//绘制进度条 ━━━━━━━━●━━━━━━━━━━━━━━━━━━━━
void drawProgressBar(int length,float progress){
    int left = (int)(length*progress+0.5);
    int right = length-left;
    setColor(hConsole,8);
    for(int i=0;i<left;++i) printf("━");
    setColor(hConsole,10);
    printf("●");
    setColor(hConsole,4);
    for(int i=0;i<right;++i) printf("━");
}

//播放进度条 0:30 ━━━━━━━━●━━━━━━━━━━━━━━━━━━━━ 1:35 ⇆ ◁ ❚❚ ▷ ↻
void playProgressBar(){
    clock_t startTime = clock();
    int passTime = 0;
    for(int sec=0;sec<=MUSIC_DURATION;sec++){
        setCursorPos(hConsole,5,IMG_HEIGHT+2);
        setColor(hConsole,8);
        printf("\t%2d:%02d ",sec/60,sec%60);
        drawProgressBar(52,(float)sec/MUSIC_DURATION);
        setColor(hConsole,8);
        printf("  %d:%02d",MUSIC_DURATION/60,MUSIC_DURATION%60);
        printf(" ⇆ ◁ ❚❚ ▷ ↻\n");
        passTime = clock()-startTime;
        Sleep((sec+1)*1000-passTime);
        setColor(hConsole,10);
    }
    
}

int main(){
    createTmpMidFile();
    initWindow();
    drawGanyu();
    HANDLE musicThread = CreateThread(NULL, 0, playMusic, NULL, 0, NULL);
    playProgressBar();
    system("pause");
    CloseHandle(musicThread);
    remove(TMP_FILE_NAME);
    return 0;
}